!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common/http"),require("rxjs/operators"),require("rxjs"),require("@angular/router"),require("@angular/forms"),require("@angular/common")):"function"==typeof define&&define.amd?define("sh-http-client",["exports","@angular/core","@angular/common/http","rxjs/operators","rxjs","@angular/router","@angular/forms","@angular/common"],e):e((t=t||self)["sh-http-client"]={},t.ng.core,t.ng.common.http,t.rxjs.operators,t.rxjs,t.ng.router,t.ng.forms,t.ng.common)}(this,(function(t,e,r,n,o,i,s,a){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var c=function(t,e){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function u(t,e){function r(){this.constructor=t}c(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function p(t,e,r,n){return new(r||(r=Promise))((function(o,i){function s(t){try{c(n.next(t))}catch(t){i(t)}}function a(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){t.done?o(t.value):new r((function(e){e(t.value)})).then(s,a)}c((n=n.apply(t,e||[])).next())}))}function l(t,e){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}var h=function(){};var f=function(){};var d=function(){};var v=function(){function t(){}return t.prototype.stringFormat=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var n=t;return e.forEach((function(t,e){n=n.split("{"+e+"}").join(t)})),n},t}(),y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.execution=function(t){return this.stringFormat("{0}を行います。\nよろしいですか？",t)},e.prototype.finalization=function(t){return this.stringFormat("{0}を終了します。\nよろしいですか？",t)},e.prototype.creatingRecord=function(){return this.execution("登録")},e.prototype.editingRecord=function(){return this.execution("修正")},e.prototype.deletingRecord=function(){return this.execution("削除")},e.prototype.updatingRecord=function(){return this.execution("更新")},e.prototype.printingOut=function(){return this.execution("印刷")},e.prototype.editingContentWillBeLost=function(){return"編集内容が失われます。\nよろしいですか？"},e}(v),g=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.systemErrorHasOccurred=function(){return"システムエラーが発生しました。システム管理者に連絡してください。"},e}(v),b=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.dontUseHistoryBack=function(t){return this.stringFormat("前のページに戻る場合、{0}ボタンから戻ってください。",t)},e}(v),I=function(){this.confirm=new y,this.fatal=new g,this.info=new b};var m={STATUS_OK:200,RELOAD:"reload",HTTP:"http",API_URL:"/api/",VERSION_API_URL:"/api/Version/",VERSION_NO:"Version-No",AUTHORIZATION_TOKEN:"AccessToken",Bearer:"Bearer ",REDIRECT_PATH:"REDIRECT_PATH",SH_QUERY_PARAMS:"SH_QUERY_PARAMS"},S=function(){function t(t){this.http=t,this.versions=[]}return t.prototype.initVersion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return p(this,void 0,void 0,(function(){var e=this;return l(this,(function(r){switch(r.label){case 0:return t?[4,Promise.all(t.map((function(t){return p(e,void 0,void 0,(function(){var e;return l(this,(function(r){switch(r.label){case 0:return[4,this.fetchVersion(t)];case 1:return e=r.sent(),this.setVersionNo(t,e),[2]}}))}))})))]:[2];case 1:return r.sent(),[2]}}))}))},t.prototype.getKeyUrl=function(t){return t?t.split(m.API_URL)[0]+m.VERSION_API_URL:""},t.prototype.fetchVersion=function(t){return p(this,void 0,void 0,(function(){var e,r;return l(this,(function(n){return e=this.splitByApiUrl(t),r=sessionStorage.getItem(""+m.AUTHORIZATION_TOKEN),[2,this.http.get(e,{observe:"response",headers:{Authorization:r?m.Bearer+r:m.Bearer}}).toPromise().then((function(t){return t.body.redirectURL==m.RELOAD?setTimeout((function(){location.reload()}),100):-1!=(t.body.redirectURL||"").indexOf(m.HTTP)&&setTimeout((function(){location.href=t.body.redirectURL}),100),t.body.applicationData?t.body.applicationData.versionNo:""}))]}))}))},t.prototype.splitByApiUrl=function(t){return t.split(m.API_URL)[0]+m.VERSION_API_URL||""},t.prototype.getVersion=function(t){return p(this,void 0,void 0,(function(){var e,r,n;return l(this,(function(o){switch(o.label){case 0:return e=this.getKeyUrl(t),(r=this.versions.find((function(t){return t.keyUrl===e})))?[3,2]:[4,this.fetchVersion(t)];case 1:return n=o.sent(),this.setVersionNo(t,n),[2,n];case 2:return[2,r.version]}}))}))},t.prototype.setVersionNo=function(t,e){var r=this.getKeyUrl(t);if(r&&e){var n=this.versions.findIndex((function(t){return t.keyUrl==r}));-1!=n?this.versions[n]={keyUrl:r,version:e}:this.versions.push({keyUrl:r,version:e})}},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:r.HttpClient}]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(r.HttpClient))},token:t,providedIn:"root"}),t}();var A=function(){function t(){this.Alert=new h,this.AlertHandlerSubject=new o.Subject,this.AlertHandlerState=this.AlertHandlerSubject.asObservable()}return t.prototype.setAlert=function(t){this.Alert=t,this.AlertHandlerSubject.next(this.Alert)},t.prototype.alertClear=function(){this.Alert.message="",this.Alert.type="",this.AlertHandlerSubject.next(this.Alert)},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}();var R=function(){};var j=function(){function t(){this.validationError=new R,this.validationErrorSubject=new o.Subject,this.validationErrorState=this.validationErrorSubject.asObservable()}return t.prototype.setValidationError=function(t){this.validationError.show=!0,this.validationError.meesages=t,this.validationErrorSubject.next(this.validationError)},t.prototype.clearValidationError=function(){this.validationError.show=!1,this.validationError.meesages=null,this.validationErrorSubject.next(this.validationError)},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}();var E=new e.InjectionToken("Browser Storage",{providedIn:"root",factory:function(){return localStorage}}),H=new e.InjectionToken("UseHash",{providedIn:"root",factory:function(){return{useHash:!0}}}),T=function(){function t(t,e,r){this.router=t,this.storage=e,this.isHash=r}return Object.defineProperty(t.prototype,"redirectPath",{get:function(){return this.storage.getItem(m.REDIRECT_PATH)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryParams",{get:function(){return new URLSearchParams(this.storage.getItem(m.SH_QUERY_PARAMS))||null},enumerable:!0,configurable:!0}),t.prototype.setRedirectPath=function(){var t="",e="";if(this.isHash.useHash){var r=location.href.split("#")[1].split("?");t=r[0],e=r[1]||""}else t=location.pathname,t=location.search;this.storage.setItem(m.REDIRECT_PATH,t),this.storage.setItem(m.SH_QUERY_PARAMS,e)},t.prototype.redirect=function(){this.router.navigate([this.storage.getItem(m.REDIRECT_PATH)]),this.storage.setItem(m.REDIRECT_PATH,"")},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:i.Router},{type:Storage,decorators:[{type:e.Inject,args:[E]}]},{type:void 0,decorators:[{type:e.Inject,args:[H]}]}]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(i.Router),e.ɵɵinject(E),e.ɵɵinject(H))},token:t,providedIn:"root"}),t}();var O=function(){function t(t,e,r,n,o){this.http=t,this.versionService=e,this.alertHandlerService=r,this.validationErrorService=n,this.redirectService=o}return Object.defineProperty(t.prototype,"hasToken",{get:function(){return!!sessionStorage.getItem("AccessToken")},enumerable:!0,configurable:!0}),t.prototype.getOption=function(t){var e=sessionStorage.getItem(""+m.AUTHORIZATION_TOKEN),n=new r.HttpHeaders({"Version-No":t});n=n.set("Content-Type","application/json; charset=utf-8");var o=e?m.Bearer+e:m.Bearer;return{observe:"response",headers:n=n.set("Authorization",o)}},t.prototype.getApiResponseBody=function(t,e){return t.status!=m.STATUS_OK?new f:(t.body&&(t.body.message&&alert(t.body.message),t.body.message&&alert(t.body.message),t.body.redirectURL==m.RELOAD?setTimeout((function(){location.reload()}),100):-1!=(t.body.redirectURL||"").indexOf(m.HTTP)&&(this.redirectService.setRedirectPath(),setTimeout((function(){location.href=t.body.redirectURL}),100)),e&&(t.body.hasValidationErrors?this.validationErrorService.setValidationError(t.body.validationErrors):this.validationErrorService.clearValidationError()),t.body.alert&&this.alertHandlerService.setAlert(t.body.alert)),t.body)},t.prototype.isAuthenticate=function(){return!!sessionStorage.getItem(""+m.AUTHORIZATION_TOKEN)},t.prototype.get=function(t,e){return void 0===e&&(e=!0),p(this,void 0,void 0,(function(){var r,o,i=this;return l(this,(function(s){switch(s.label){case 0:return r="",this.isAuthenticate()?[4,this.versionService.getVersion(t)]:[3,2];case 1:r=s.sent(),s.label=2;case 2:return o=this.getOption(r),[2,this.http.get(this.encodeUrl(t),o).pipe(n.map((function(t){return i.getApiResponseBody(t,e)})),n.catchError(this.handleError("get error"))).toPromise()]}}))}))},t.prototype.post=function(t,e,r){return void 0===r&&(r=!0),p(this,void 0,void 0,(function(){var o,i,s=this;return l(this,(function(a){switch(a.label){case 0:return[4,this.versionService.getVersion(t)];case 1:return o=a.sent(),i=this.getOption(o),[2,this.http.post(t,e,i).pipe(n.map((function(t){return s.getApiResponseBody(t,r)})),n.catchError(this.handleError("post error"))).toPromise()]}}))}))},t.prototype.put=function(t,e,r){return void 0===r&&(r=!0),p(this,void 0,void 0,(function(){var o,i,s=this;return l(this,(function(a){switch(a.label){case 0:return[4,this.versionService.getVersion(t)];case 1:return o=a.sent(),i=this.getOption(o),[2,this.http.put(t,e,i).pipe(n.map((function(t){return s.getApiResponseBody(t,r)})),n.catchError(this.handleError("put error"))).toPromise()]}}))}))},t.prototype.delete=function(t,e){return void 0===e&&(e=!0),p(this,void 0,void 0,(function(){var r,o,i=this;return l(this,(function(s){switch(s.label){case 0:return[4,this.versionService.getVersion(t)];case 1:return r=s.sent(),o=this.getOption(r),[2,this.http.delete(t,o).pipe(n.map((function(t){return i.getApiResponseBody(t,e)})),n.catchError(this.handleError("delete error"))).toPromise()]}}))}))},t.prototype.handleError=function(t,e){return void 0===t&&(t="operation"),function(t){var e=new I;throw alert(e.fatal.systemErrorHasOccurred()),t}},t.prototype.encodeUrl=function(t){if(t)return t.indexOf("?")?encodeURI(t):t},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:r.HttpClient},{type:S},{type:A},{type:j},{type:T}]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(r.HttpClient),e.ɵɵinject(S),e.ɵɵinject(A),e.ɵɵinject(j),e.ɵɵinject(T))},token:t,providedIn:"root"}),t}();var P=function(){function t(t){this.http=t}return t.prototype.isAuthenticated=function(){return this.token=sessionStorage.getItem(""+m.AUTHORIZATION_TOKEN),this.token?o.of(!0):o.of(!1)},t.prototype.login=function(t,e,r){return sessionStorage.setItem(m.AUTHORIZATION_TOKEN,t+e+r),o.of(!0)},t.prototype.logout=function(t){return this.http.get(t).then((function(t){sessionStorage.removeItem(m.AUTHORIZATION_TOKEN)}))},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:O}]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(O))},token:t,providedIn:"root"}),t}();var w=function(){function t(){this.isBackClicked=!1}return t.prototype.getBackClicked=function(){return this.isBackClicked},t.prototype.setBackClicked=function(t){this.isBackClicked=t},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}();var _=function(){function t(t,e){this.http=t,this.router=e,this.isBackButton=!1,this.config={url:"",useHash:!0}}return t.prototype.push=function(t){return p(this,void 0,void 0,(function(){return l(this,(function(e){return[2,this.http.post(this.config.url,t)]}))}))},t.prototype.configure=function(t){var e=t.url,r=t.useHash;return e&&(this.config.url=e),null!=r&&(this.config.useHash=r),this},t.prototype.trackingPath=function(){var t=this;this.router.events.subscribe((function(e){return p(t,void 0,void 0,(function(){var t;return l(this,(function(r){switch(r.label){case 0:return e instanceof i.NavigationEnd?this.isBackButton?(this.isBackButton=!1,[2]):(t=this.config.useHash?"#"+e.urlAfterRedirects:e.urlAfterRedirects.replace("/",""),[4,this.push({path:t})]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))}))},t.prototype.action=function(t){return p(this,void 0,void 0,(function(){var e;return l(this,(function(r){switch(r.label){case 0:return e=this.config.useHash?"#"+this.router.url:this.router.url.replace("/",""),[4,this.push({path:e,action:t})];case 1:return r.sent(),[2]}}))}))},t.prototype.stopLoggingPath=function(){this.isBackButton=!0},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:O},{type:i.Router}]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(O),e.ɵɵinject(i.Router))},token:t,providedIn:"root"}),t}();var k=function(){function t(t,e){this.authService=t,this.router=e}return t.prototype.canActivate=function(t,e){return this.authService.isAuthenticated().pipe(n.tap((function(t){t||alert("認証に失敗しました。メールアドレスとパスワードを再度確認してください。")})))},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:P},{type:i.Router}]},t}();var U=function(){function t(t){this.navigationService=t}return t.prototype.canDeactivate=function(t){return!this.navigationService.getBackClicked()||(this.navigationService.setBackClicked(!1),history.pushState(null,null,location.href),!1)},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:w}]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(w))},token:t,providedIn:"root"}),t}();var B=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{declarations:[],imports:[s.FormsModule,a.CommonModule],exports:[],providers:[]}]}],t}();t.Alert=h,t.AlertHandlerService=A,t.ApiResponse=d,t.ApiResponseBody=f,t.AuthGuard=k,t.AuthService=P,t.LoggerService=_,t.NavigationGuard=U,t.NavigationService=w,t.Response="response",t.SHMessage=I,t.SHMessageConfirm=y,t.SHMessageFatal=g,t.SHMessageInfo=b,t.SHMessageUtl=v,t.SH_BROWSER_STORAGE=E,t.ShHttpClient=B,t.ShHttpClientConst=m,t.ShHttpClientService=O,t.ShRedirectService=T,t.USE_HASH=H,t.ValidationErrorService=j,t.VersionNo="Version-No",t.VersionService=S,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=sh-http-client.umd.min.js.map